(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
'use strict';

var _debounce = require('utilise/debounce');

var _debounce2 = _interopRequireDefault(_debounce);

var _escape = require('utilise/escape');

var _escape2 = _interopRequireDefault(_escape);

var _noop = require('utilise/noop');

var _noop2 = _interopRequireDefault(_noop);

var _raw = require('utilise/raw');

var _raw2 = _interopRequireDefault(_raw);

var _to = require('utilise/to');

var _to2 = _interopRequireDefault(_to);

var _rijs = require('rijs.core');

var _rijs2 = _interopRequireDefault(_rijs);

var _rijs3 = require('rijs.data');

var _rijs4 = _interopRequireDefault(_rijs3);

var _rijs5 = require('rijs.sync');

var _rijs6 = _interopRequireDefault(_rijs5);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var ripple = (0, _rijs6.default)((0, _rijs4.default)((0, _rijs2.default)())),
    con = window.console,
    log = con ? Function.prototype.bind.call(con.log, con) : _noop2.default;

var html = '',
    running = true,
    failures = 0,
    passes = 0,
    tests = 0,
    name = 'All Tests',
    output = (0, _raw2.default)('pre');

// reload on force reload
ripple.io.on('reload', reload);

// after first connect, reload on reconnect
ripple.io.on('connect', function (d) {
  return ripple.io.on('connect', reload);
});

// send tests-starting signal
ripple('results', {
  stats: { running: running },
  suites: [],
  html: 'Test in progress..'
});

// proxy errors back to terminal
window.onerror = function (message, url, linenumber) {
  return ripple.io.emit('global err', message, url, linenumber);
}

// proxy console logs back to terminal
;['log', 'info', 'warn', 'error', 'debug'].map(function (m) {
  if (!con || !con[m]) return; // ie
  var sup = Function.prototype.bind.call(con[m], con);
  window.console[m] = function () {
    var args = _to2.default.arr(arguments);
    ripple.io.emit('console', m, args.map(function (d) {
      return d;
    }));
    sup.apply && sup.apply(con, arguments);
  };
});

// stream results back
var update = (0, _debounce2.default)(500)(function () {
  var stats = { running: running, tests: tests, passes: passes, failures: failures },
      suites = [{ name: name, failures: failures, total: tests }];

  output.innerHTML = html;
  ripple('results', { stats: stats, suites: suites, html: html });
})

// listen on log
;(window.console = window.console || {}).log = function () {
  var line = _to2.default.arr(arguments).join(' ');
  html += (0, _escape2.default)(line) + '\n';

  if (-1 === includes('# tests')(line)) running = false;
  if (-1 === includes('ok ')(line)) {
    passes++;tests++;
  }
  if (-1 === includes('not ok ')(line)) {
    failures++;tests++;
  }

  if (line.match(/^(?!.*\[ri\/)/)) update();
  log.apply(console, arguments);
};

function reload() {
  location.reload();
}
},{"rijs.core":4,"rijs.data":6,"rijs.sync":7,"utilise/debounce":14,"utilise/escape":18,"utilise/noop":29,"utilise/raw":35,"utilise/to":38}],2:[function(require,module,exports){

},{}],3:[function(require,module,exports){
// shim for using process in browser

var process = module.exports = {};

// cached from whatever global is present so that test runners that stub it
// don't break things.  But we need to wrap it in a try catch in case it is
// wrapped in strict mode code which doesn't define any globals.  It's inside a
// function because try/catches deoptimize in certain engines.

var cachedSetTimeout;
var cachedClearTimeout;

(function () {
  try {
    cachedSetTimeout = setTimeout;
  } catch (e) {
    cachedSetTimeout = function () {
      throw new Error('setTimeout is not defined');
    }
  }
  try {
    cachedClearTimeout = clearTimeout;
  } catch (e) {
    cachedClearTimeout = function () {
      throw new Error('clearTimeout is not defined');
    }
  }
} ())
var queue = [];
var draining = false;
var currentQueue;
var queueIndex = -1;

function cleanUpNextTick() {
    if (!draining || !currentQueue) {
        return;
    }
    draining = false;
    if (currentQueue.length) {
        queue = currentQueue.concat(queue);
    } else {
        queueIndex = -1;
    }
    if (queue.length) {
        drainQueue();
    }
}

function drainQueue() {
    if (draining) {
        return;
    }
    var timeout = cachedSetTimeout.call(null, cleanUpNextTick);
    draining = true;

    var len = queue.length;
    while(len) {
        currentQueue = queue;
        queue = [];
        while (++queueIndex < len) {
            if (currentQueue) {
                currentQueue[queueIndex].run();
            }
        }
        queueIndex = -1;
        len = queue.length;
    }
    currentQueue = null;
    draining = false;
    cachedClearTimeout.call(null, timeout);
}

process.nextTick = function (fun) {
    var args = new Array(arguments.length - 1);
    if (arguments.length > 1) {
        for (var i = 1; i < arguments.length; i++) {
            args[i - 1] = arguments[i];
        }
    }
    queue.push(new Item(fun, args));
    if (queue.length === 1 && !draining) {
        cachedSetTimeout.call(null, drainQueue, 0);
    }
};

// v8 likes predictible objects
function Item(fun, array) {
    this.fun = fun;
    this.array = array;
}
Item.prototype.run = function () {
    this.fun.apply(null, this.array);
};
process.title = 'browser';
process.browser = true;
process.env = {};
process.argv = [];
process.version = ''; // empty string to avoid regexp issues
process.versions = {};

function noop() {}

process.on = noop;
process.addListener = noop;
process.once = noop;
process.off = noop;
process.removeListener = noop;
process.removeAllListeners = noop;
process.emit = noop;

process.binding = function (name) {
    throw new Error('process.binding is not supported');
};

process.cwd = function () { return '/' };
process.chdir = function (dir) {
    throw new Error('process.chdir is not supported');
};
process.umask = function() { return 0; };

},{}],4:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = core;

var _emitterify = require('utilise/emitterify');

var _emitterify2 = _interopRequireDefault(_emitterify);

var _colorfill = require('utilise/colorfill');

var _colorfill2 = _interopRequireDefault(_colorfill);

var _identity = require('utilise/identity');

var _identity2 = _interopRequireDefault(_identity);

var _header = require('utilise/header');

var _header2 = _interopRequireDefault(_header);

var _values = require('utilise/values');

var _values2 = _interopRequireDefault(_values);

var _key = require('utilise/key');

var _key2 = _interopRequireDefault(_key);

var _is = require('utilise/is');

var _is2 = _interopRequireDefault(_is);

var _to = require('utilise/to');

var _to2 = _interopRequireDefault(_to);

var _za = require('utilise/za');

var _za2 = _interopRequireDefault(_za);

var _text = require('./types/text');

var _text2 = _interopRequireDefault(_text);

/* istanbul ignore next */
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

// -------------------------------------------
// API: Gets or sets a resource
// -------------------------------------------
// ripple('name')     - returns the resource body if it exists
// ripple('name')     - creates & returns resource if it doesn't exist
// ripple('name', {}) - creates & returns resource, with specified name and body
// ripple({ ... })    - creates & returns resource, with specified name, body and headers
// ripple.resources   - returns raw resources
// ripple.resource    - alias for ripple, returns ripple instead of resource for method chaining
// ripple.register    - alias for ripple
// ripple.on          - event listener for changes - all resources
// ripple('name').on  - event listener for changes - resource-specific

function core() {
  log('creating');

  var resources = {};
  ripple.resources = resources;
  ripple.resource = chainable(ripple);
  ripple.register = ripple;
  ripple.types = types();
  return (0, _emitterify2.default)(ripple);

  function ripple(name, body, headers) {
    return !name ? ripple : _is2.default.arr(name) ? name.map(ripple) : _is2.default.obj(name) && !name.name ? ripple((0, _values2.default)(name)) : _is2.default.fn(name) && name.resources ? ripple((0, _values2.default)(name.resources)) : _is2.default.str(name) && !body && resources[name] ? resources[name].body : _is2.default.str(name) && !body && !resources[name] ? register(ripple)({ name: name }) : _is2.default.str(name) && body ? register(ripple)({ name: name, body: body, headers: headers }) : _is2.default.obj(name) && !_is2.default.arr(name) ? register(ripple)(name) : (err('could not find or create resource', name), false);
  }
}

var register = function register(ripple) {
  return function (_ref) {
    var name = _ref.name;
    var body = _ref.body;
    var _ref$headers = _ref.headers;
    var headers = _ref$headers === undefined ? {} : _ref$headers;

    log('registering', name);
    var res = normalise(ripple)({ name: name, body: body, headers: headers });

    if (!res) return err('failed to register', name), false;
    ripple.resources[name] = res;
    ripple.emit('change', [name, {
      type: 'update',
      value: res.body,
      time: now(res)
    }]);
    return ripple.resources[name].body;
  };
};

var normalise = function normalise(ripple) {
  return function (res) {
    if (!(0, _header2.default)('content-type')(res)) (0, _values2.default)(ripple.types).sort((0, _za2.default)('priority')).some(contentType(res));
    if (!(0, _header2.default)('content-type')(res)) return err('could not understand resource', res), false;
    return parse(ripple)(res);
  };
};

var parse = function parse(ripple) {
  return function (res) {
    var type = (0, _header2.default)('content-type')(res);
    if (!ripple.types[type]) return err('could not understand type', type), false;
    return (ripple.types[type].parse || _identity2.default)(res);
  };
};

var contentType = function contentType(res) {
  return function (type) {
    return type.check(res) && (res.headers['content-type'] = type.header);
  };
};

var types = function types() {
  return [_text2.default].reduce(_to2.default.obj('header'), 1);
};

var chainable = function chainable(fn) {
  return function () {
    return fn.apply(this, arguments), fn;
  };
};

var err = require('utilise/err')('[ri/core]'),
    log = require('utilise/log')('[ri/core]'),
    now = function now(d, t) {
  return t = (0, _key2.default)('body.log.length')(d), _is2.default.num(t) ? t - 1 : t;
};
},{"./types/text":5,"utilise/colorfill":11,"utilise/emitterify":16,"utilise/err":17,"utilise/header":22,"utilise/identity":23,"utilise/is":25,"utilise/key":26,"utilise/log":28,"utilise/to":38,"utilise/values":39,"utilise/za":40}],5:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _includes = require('utilise/includes');

var _includes2 = _interopRequireDefault(_includes);

var _is = require('utilise/is');

var _is2 = _interopRequireDefault(_is);

/* istanbul ignore next */
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

exports.default = {
  header: 'text/plain',
  check: function check(res) {
    return !(0, _includes2.default)('.html')(res.name) && !(0, _includes2.default)('.css')(res.name) && _is2.default.str(res.body);
  }
};
},{"utilise/includes":24,"utilise/is":25}],6:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = data;

var _overwrite = require('utilise/overwrite');

var _overwrite2 = _interopRequireDefault(_overwrite);

var _header = require('utilise/header');

var _header2 = _interopRequireDefault(_header);

var _extend = require('utilise/extend');

var _extend2 = _interopRequireDefault(_extend);

var _not = require('utilise/not');

var _not2 = _interopRequireDefault(_not);

var _key = require('utilise/key');

var _key2 = _interopRequireDefault(_key);

var _set = require('utilise/set');

var _set2 = _interopRequireDefault(_set);

var _is = require('utilise/is');

var _is2 = _interopRequireDefault(_is);

/* istanbul ignore next */
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

// -------------------------------------------
// Adds support for data resources
// -------------------------------------------
function data(ripple) {
  log('creating');
  ripple.on('change.data', trickle(ripple));
  ripple.types['application/data'] = {
    header: 'application/data',
    check: function check(res) {
      return _is2.default.obj(res.body) || !res.body ? true : false;
    },
    parse: function parse(res) {
      var existing = ripple.resources[res.name] || {};

      (0, _extend2.default)(res.headers)(existing.headers);
      res.body = (0, _set2.default)()(res.body || [], existing.body && existing.body.log, _is2.default.num(res.headers.log) ? res.headers.log : -1);
      (0, _overwrite2.default)(res.body.on)(listeners(existing));
      res.body.on('change.bubble', function (change) {
        ripple.emit('change', ripple.change = [res.name, change], (0, _not2.default)(_is2.default.in(['data'])));
        delete ripple.change;
      });

      return res;
    }
  };

  return ripple;
}

var trickle = function trickle(ripple) {
  return function (name, change) {
    return (0, _header2.default)('content-type', 'application/data')(ripple.resources[name]) && ripple.resources[name].body.emit('change', [change || null], (0, _not2.default)(_is2.default.in(['bubble'])));
  };
};

var log = require('utilise/log')('[ri/types/data]'),
    listeners = (0, _key2.default)('body.on');
},{"utilise/extend":19,"utilise/header":22,"utilise/is":25,"utilise/key":26,"utilise/log":28,"utilise/not":30,"utilise/overwrite":31,"utilise/set":36}],7:[function(require,module,exports){
(function (process){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = sync;

var _identity = require('utilise/identity');

var _identity2 = _interopRequireDefault(_identity);

var _promise = require('utilise/promise');

var _promise2 = _interopRequireDefault(_promise);

var _values = require('utilise/values');

var _values2 = _interopRequireDefault(_values);

var _extend = require('utilise/extend');

var _extend2 = _interopRequireDefault(_extend);

var _header = require('utilise/header');

var _header2 = _interopRequireDefault(_header);

var _client = require('utilise/client');

/* istanbul ignore next */
var _client2 = _interopRequireDefault(_client);

var _clone = require('utilise/clone');

var _clone2 = _interopRequireDefault(_clone);

var _noop = require('utilise/noop');

/* istanbul ignore next */
var _noop2 = _interopRequireDefault(_noop);

var _keys = require('utilise/keys');

var _keys2 = _interopRequireDefault(_keys);

var _not = require('utilise/not');

var _not2 = _interopRequireDefault(_not);

var _str = require('utilise/str');

var _str2 = _interopRequireDefault(_str);

var _set = require('utilise/set');

var _set2 = _interopRequireDefault(_set);

var _key = require('utilise/key');

var _key2 = _interopRequireDefault(_key);

var _by = require('utilise/by');

var _by2 = _interopRequireDefault(_by);

var _is = require('utilise/is');

var _is2 = _interopRequireDefault(_is);

var _to = require('utilise/to');

/* istanbul ignore next */
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

// -------------------------------------------
// Synchronises resources between server/client
// -------------------------------------------
function sync(ripple, server) {
  log('creating');

/* istanbul ignore next */
  if (!_client2.default && !server) return ripple;
/* istanbul ignore next */
  if (!_client2.default) ripple.to = clean(ripple.to), (0, _values2.default)(ripple.types).map(function (type) {
    return type.parse = headers(ripple)(type.parse);
  });

  ripple.io = io(server);
  ripple.io.use(ip);
  ripple.req = send(ripple)(ripple);
/* istanbul ignore next */
  ripple.send = _client2.default ? send(ripple)(ripple.io) : send(ripple);
  ripple.on('change.send', broadcast(ripple));
  ripple.io.on('change', consume(ripple));
  ripple.io.on('connection', connected(ripple));
  return ripple;
}

var connected = function connected(ripple) {
  return function (socket) {
    log('connected'.green, (0, _str2.default)(socket.ip).grey);
    socket.on('change', consume(ripple));
    ripple.send(socket)();
  };
};

var broadcast = function broadcast(ripple) {
  return function (name, change) {
/* istanbul ignore next */
    (_client2.default ? ripple.send : ripple.send())((0, _extend2.default)({ name: name })(change));
  };
};

var normalize = function normalize(ripple) {
  var next = arguments.length <= 1 || arguments[1] === undefined ? _identity2.default : arguments[1];
  return function (name, type, value) {
    var req = _is2.default.obj(name) ? name : { name: name, type: type, value: value },
        resource = ripple.resources[req.name];

    if (!req.name) return next((0, _values2.default)(ripple.resources).map(normalize(ripple)));

    if (!resource) return Promise.resolve([404, err('cannot find ' + req.name)]);

    if (!req.type) req = {
      name: req.name,
      type: 'update',
      headers: resource.headers,
      value: resource.body,
      time: now(resource)
    };

    if (req.type == 'update' && !req.key) req.headers = resource.headers;

    return next(req);
  };
};

// send all or some req, to all or some sockets
var send = function send(ripple) {
  var l = arguments.length <= 1 || arguments[1] === undefined ? log : arguments[1];
  return function (who) {
    return normalize(ripple, function (req) {
      var count = function count(sent) {
        return (0, _str2.default)(sent.length).green.bold + '/' + (0, _str2.default)(everyone.length).green;
      },
          all = function all(d) {
        return req.length && log('send'.grey, count(sockets), 'all'.bold, ('(' + req.length + ')').grey);
      },
/* istanbul ignore next */
          everyone = _client2.default ? [ripple.io] : (0, _values2.default)(ripple.io.of('/').sockets),
          sockets = _is2.default.arr(who) ? who : _is2.default.str(who) ? everyone.filter((0, _by2.default)('sessionID', who)) : !who ? everyone : [who],
/* istanbul ignore next */
          promises = _is2.default.arr(req) ? (all(), req.map(send(ripple, l = _noop2.default)(sockets))) : sockets.map(function (s) {
        return to(ripple, req, s);
      }).filter(Boolean);

      if (promises.length) l('send'.grey, count(promises), req.name);
      return Promise.all(promises);
    });
  };
};

// outgoing transforms
var to = function to(ripple, req, socket, resource) {
  if ((0, _header2.default)('silent', socket)(resource = ripple.resources[req.name])) return delete resource.headers.silent, false;

  var nametype = '(' + req.name + ', ' + req.type + ')',
      xres = (0, _header2.default)('to')(resource) || _identity2.default,
      xtyp = type(ripple)(resource).to || _identity2.default,
      xall = ripple.to || _identity2.default,
      p = (0, _promise2.default)();

  Promise.resolve(xall((0, _extend2.default)({ socket: socket })(req))).then(function (req) {
    return req && xtyp(req);
  }).then(function (req) {
    return req && xres(req);
  }).then(function (req) {
    return !strip(req) ? p.resolve([false]) : socket == ripple ? consume(ripple)(req, res) : socket.emit('change', req, res);
  }).catch(function (e) {
    throw new Error(err('to failed'.red, e));
  });

  return p;

  function res() {
    deb('ack'.grey, nametype, (0, _str2.default)(socket.ip).grey);
    p.resolve((0, _to.arr)(arguments));
  }
};

// incoming transforms
var consume = function consume(ripple) {
  return function (req) {
/* istanbul ignore next */
    var res = arguments.length <= 1 || arguments[1] === undefined ? _noop2.default : arguments[1];

    var nametype = '(' + req.name + ', ' + req.type + ')',
        resource = ripple.resources[req.name],
        silent = silence(req.socket = this),
        xres = (0, _header2.default)('from')(resource) || _identity2.default,
        xtyp = type(ripple)(resource).from || _identity2.default,
        xall = ripple.from || _identity2.default;

    log('recv'.grey, nametype);
    try {
      !req.name ? res(404, err('not found'.red, req.name)) : !(req = xall(req, res)) ? deb('skip', 'global', nametype) : !(req = xtyp(req, res)) ? deb('skip', 'type', nametype) : !(req = xres(req, res)) ? deb('skip', 'resource', nametype) : !req.key && req.type == 'update' ? (ripple(silent(body(req))), res(200, deb('ok ' + nametype))) : isStandardVerb(req.type) ? ((0, _set2.default)(req)(silent(resource).body), res(200, deb('ok ' + nametype, _key2.default.grey))) : !isStandardVerb(req.type) ? res(405, err('method not allowed', nametype)) : res(400, err('cannot process', nametype));
    } catch (e) {
      res(e.status || 500, err(e.message, nametype, '\n', e.stack));
    }
  };
};

var body = function body(_ref) {
  var name = _ref.name;
  var _body = _ref.body;
  var value = _ref.value;
  var headers = _ref.headers;
  return { name: name, headers: headers, body: value };
};

var headers = function headers(ripple) {
  return function (next) {
    return function (res) {
      var existing = ripple.resources[res.name],
          from = (0, _header2.default)('from')(res) || (0, _header2.default)('from')(existing),
          to = (0, _header2.default)('to')(res) || (0, _header2.default)('to')(existing);
      if (from) res.headers.from = from;
      if (to) res.headers.to = to;
      return next ? next(res) : res;
    };
  };
};

var io = function io(opts) {
/* istanbul ignore next */
  var r = !_client2.default ? require('socket.io')(opts.server || opts) : window.io ? window.io() : _is2.default.fn(require('socket.io-client')) ? require('socket.io-client')() : { on: _noop2.default, emit: _noop2.default };
/* istanbul ignore next */
  r.use = r.use || _noop2.default;
  return r;
};

var ip = function ip(socket, next) {
  socket.ip = socket.request.headers['x-forwarded-for'] || socket.request.connection.remoteAddress;
  next();
};

var strip = function strip(req) {
  return delete req.socket, req;
};

var clean = function clean(next) {
  return function (req, res) {
    if (_is2.default.obj(req.value)) try {
      req.value = (0, _clone2.default)(req.value);
    } catch (e) {
      err('cannot send circular structure');
      return false;
    }

    if (!req.headers || !req.headers.silent) return (next || _identity2.default)(req, res);

    var stripped = {};

    (0, _keys2.default)(req.headers).filter((0, _not2.default)((0, _is2.default)('silent'))).map(function (header) {
      return stripped[header] = req.headers[header];
    });

    req.headers = stripped;
    return (next || _identity2.default)(req, res);
  };
};

var type = function type(ripple) {
  return function (res) {
    return ripple.types[(0, _header2.default)('content-type')(res)] || {};
  };
},
    now = function now(d, t) {
  return t = (0, _key2.default)('body.log.length')(d), _is2.default.num(t) ? t - 1 : t;
},
    silence = function silence(socket) {
  return function (res) {
    return (0, _key2.default)('headers.silent', socket)(res);
  };
},
    isStandardVerb = _is2.default.in(['update', 'add', 'remove']),
    log = require('utilise/log')('[ri/sync]'),
    err = require('utilise/err')('[ri/sync]'),
/* istanbul ignore next */
    deb = (!_client2.default && process.env.DEBUG || '').split(',').some((0, _is2.default)('[ri/sync]')) ? log : _identity2.default;
}).call(this,require('_process'))
},{"_process":3,"socket.io":2,"socket.io-client":2,"utilise/by":8,"utilise/client":9,"utilise/clone":10,"utilise/err":17,"utilise/extend":19,"utilise/header":22,"utilise/identity":23,"utilise/is":25,"utilise/key":26,"utilise/keys":27,"utilise/log":28,"utilise/noop":29,"utilise/not":30,"utilise/promise":34,"utilise/set":36,"utilise/str":37,"utilise/to":38,"utilise/values":39}],8:[function(require,module,exports){
var key = require('./key')
  , is  = require('./is')

module.exports = function by(k, v){
  var exists = arguments.length == 1
  return function(o){
    var d = is.fn(k) ? k(o) : key(k)(o)
    
    return d && v && d.toLowerCase && v.toLowerCase ? d.toLowerCase() === v.toLowerCase()
         : exists ? Boolean(d)
         : is.fn(v) ? v(d)
         : d == v
  }
}
},{"./is":25,"./key":26}],9:[function(require,module,exports){
module.exports = typeof window != 'undefined'
},{}],10:[function(require,module,exports){
var parse = require('./parse')
  , str = require('./str')
  , is = require('./is')

module.exports = function clone(d) {
  return !is.fn(d) && !is.str(d)
       ? parse(str(d))
       : d
}

},{"./is":25,"./parse":33,"./str":37}],11:[function(require,module,exports){
var client = require('./client')
  , colors = !client && require('colors')
  , has = require('./has')
  , is = require('./is')

module.exports = colorfill()

function colorfill(){
  /* istanbul ignore next */
  ['red', 'green', 'bold', 'grey', 'strip'].forEach(function(color) {
    !is.str(String.prototype[color]) && Object.defineProperty(String.prototype, color, {
      get: function() {
        return String(this)
      } 
    })
  })
}


},{"./client":9,"./has":21,"./is":25,"colors":2}],12:[function(require,module,exports){
module.exports = function copy(from, to){ 
  return function(d){ 
    return to[d] = from[d], d
  }
}
},{}],13:[function(require,module,exports){
module.exports = function datum(node){
  return node.__data__
}
},{}],14:[function(require,module,exports){
var is = require('./is')

module.exports = function debounce(d){
  var pending, wait = is.num(d) ? d : 100

  return is.fn(d) 
       ? next(d)
       : next

  function next(fn){
    return function(){
      var ctx = this, args = arguments
      pending && clearTimeout(pending)
      pending = setTimeout(function(){ fn.apply(ctx, args) }, wait)
    }
  }
  
}
},{"./is":25}],15:[function(require,module,exports){
var has = require('./has')

module.exports = function def(o, p, v, w){
  if (o.host && o.host.nodeName) o = o.host
  if (p.name) v = p, p = p.name
  !has(o, p) && Object.defineProperty(o, p, { value: v, writable: w })
  return o[p]
}

},{"./has":21}],16:[function(require,module,exports){
var err  = require('./err')('[emitterify]')
  , keys = require('./keys')
  , def  = require('./def')
  , not  = require('./not')
  , is   = require('./is')
  
module.exports = function emitterify(body, dparam) {
  return def(body, 'emit', emit, 1)
       , def(body, 'once', once, 1)
       , def(body, 'on', on, 1)
       , body

  function emit(type, param, filter) {
    var ns = type.split('.')[1]
      , id = type.split('.')[0]
      , li = body.on[id] || []
      , tt = li.length - 1
      , tp = is.def(param)  ? param 
           : is.def(dparam) ? dparam
           : [body]
      , pm = tp.length && !is.str(tp) ? tp : [tp]

    if (ns) return invoke(li, ns, pm), body

    for (var i = li.length; i >=0; i--)
      invoke(li, i, pm)

    keys(li)
      .filter(not(isFinite))
      .filter(filter || Boolean)
      .map(function(n){ return invoke(li, n, pm) })

    return body
  }

  function invoke(o, k, p){
    if (!o[k]) return
    var fn = o[k]
    o[k].once && (isFinite(k) ? o.splice(k, 1) : delete o[k])
    try { fn.apply(body, p) } catch(e) { err(e, e.stack)  }
   }

  function on(type, callback) {
    var ns = type.split('.')[1]
      , id = type.split('.')[0]

    body.on[id] = body.on[id] || []
    return !callback && !ns ? (body.on[id])
         : !callback &&  ns ? (body.on[id][ns])
         :  ns              ? (body.on[id][ns] = callback, body)
                            : (body.on[id].push(callback), body)
  }

  function once(type, callback){
    return callback.once = true, body.on(type, callback), body
  }
}
},{"./def":15,"./err":17,"./is":25,"./keys":27,"./not":30}],17:[function(require,module,exports){
var owner = require('./owner')
  , to = require('./to')

module.exports = function err(prefix){
  return function(d){
    if (!owner.console || !console.error.apply) return d;
    var args = to.arr(arguments)
    args.unshift(prefix.red ? prefix.red : prefix)
    return console.error.apply(console, args), d
  }
}
},{"./owner":32,"./to":38}],18:[function(require,module,exports){
module.exports = function escape(str) {
  return str.replace(/[&<>'"]/g, function(char){
    return safe[char]
  })
}

var safe = { 
  "&": "&amp;"
, "<": "&lt;"
, ">": "&gt;"
, '"': "&quot;"
, "'": "&#39;"
}

},{}],19:[function(require,module,exports){
var is = require('./is')
  , not = require('./not')
  , keys = require('./keys')
  , copy = require('./copy')

module.exports = function extend(to){ 
  return function(from){
    keys(from)
      .filter(not(is.in(to)))
      .map(copy(from, to))

    return to
  }
}
},{"./copy":12,"./is":25,"./keys":27,"./not":30}],20:[function(require,module,exports){
var datum = require('./datum')
  , key = require('./key')

module.exports = from
from.parent = fromParent

function from(o){
  return function(k){
    return key(k)(o)
  }
}

function fromParent(k){
  return datum(this.parentNode)[k]
}
},{"./datum":13,"./key":26}],21:[function(require,module,exports){
module.exports = function has(o, k) {
  return k in o
}
},{}],22:[function(require,module,exports){
var key = require('./key')

module.exports = function header(header, value) {
  var getter = arguments.length == 1
  return function(d){ 
    return !d || !d.headers ? null
         : getter ? key(header)(d.headers)
                  : key(header)(d.headers) == value
  }
}
},{"./key":26}],23:[function(require,module,exports){
module.exports = function identity(d) {
  return d
}
},{}],24:[function(require,module,exports){
module.exports = function includes(pattern){
  return function(d){
    return d && d.indexOf && ~d.indexOf(pattern)
  }
}
},{}],25:[function(require,module,exports){
module.exports = is
is.fn      = isFunction
is.str     = isString
is.num     = isNumber
is.obj     = isObject
is.lit     = isLiteral
is.bol     = isBoolean
is.truthy  = isTruthy
is.falsy   = isFalsy
is.arr     = isArray
is.null    = isNull
is.def     = isDef
is.in      = isIn
is.promise = isPromise

function is(v){
  return function(d){
    return d == v
  }
}

function isFunction(d) {
  return typeof d == 'function'
}

function isBoolean(d) {
  return typeof d == 'boolean'
}

function isString(d) {
  return typeof d == 'string'
}

function isNumber(d) {
  return typeof d == 'number'
}

function isObject(d) {
  return typeof d == 'object'
}

function isLiteral(d) {
  return typeof d == 'object' 
      && !(d instanceof Array)
}

function isTruthy(d) {
  return !!d == true
}

function isFalsy(d) {
  return !!d == false
}

function isArray(d) {
  return d instanceof Array
}

function isNull(d) {
  return d === null
}

function isDef(d) {
  return typeof d !== 'undefined'
}

function isPromise(d) {
  return d instanceof Promise
}

function isIn(set) {
  return function(d){
    return !set ? false  
         : set.indexOf ? ~set.indexOf(d)
         : d in set
  }
}
},{}],26:[function(require,module,exports){
var str = require('./str')
  , is = require('./is')

module.exports = function key(k, v){ 
  var set = arguments.length > 1
    , keys = is.fn(k) ? [] : str(k).split('.')
    , root = keys.shift()

  return function deep(o, i){
    var masked = {}
    
    return !o ? undefined 
         : !is.num(k) && !k ? o
         : is.arr(k) ? (k.map(copy), masked)
         : o[k] || !keys.length ? (set ? ((o[k] = is.fn(v) ? v(o[k], i) : v), o)
                                       :  (is.fn(k) ? k(o) : o[k]))
                                : (set ? (key(keys.join('.'), v)(o[root] ? o[root] : (o[root] = {})), o)
                                       :  key(keys.join('.'))(o[root]))

    function copy(k){
      var val = key(k)(o)
      ;(val != undefined) && key(k, val)(masked)
    }
  }
}
},{"./is":25,"./str":37}],27:[function(require,module,exports){
var is = require('./is')

module.exports = function keys(o) { 
  return Object.keys(is.obj(o) || is.fn(o) ? o : {})
}
},{"./is":25}],28:[function(require,module,exports){
var is = require('./is')
  , to = require('./to')
  , owner = require('./owner')

module.exports = function log(prefix){
  return function(d){
    if (!owner.console || !console.log.apply) return d;
    is.arr(arguments[2]) && (arguments[2] = arguments[2].length)
    var args = to.arr(arguments)
    args.unshift(prefix.grey ? prefix.grey : prefix)
    return console.log.apply(console, args), d
  }
}
},{"./is":25,"./owner":32,"./to":38}],29:[function(require,module,exports){
module.exports = function noop(){}
},{}],30:[function(require,module,exports){
module.exports = function not(fn){
  return function(){
    return !fn.apply(this, arguments)
  }
}
},{}],31:[function(require,module,exports){
var is = require('./is')
  , keys = require('./keys')
  , copy = require('./copy')

module.exports = function overwrite(to){ 
  return function(from){
    keys(from)
      .map(copy(from, to))
        
    return to
  }
}
},{"./copy":12,"./is":25,"./keys":27}],32:[function(require,module,exports){
(function (global){
var client = require('./client')
module.exports = client ? /* istanbul ignore next */ window : global
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./client":9}],33:[function(require,module,exports){
module.exports = function parse(d){
  return d && JSON.parse(d)
}
},{}],34:[function(require,module,exports){
promise.sync = promiseSync
promise.null = promiseNull
promise.noop = promiseNoop
promise.args = promiseArgs
module.exports = promise

function promise() {
  var resolve
    , reject
    , p = new Promise(function(res, rej){ 
        resolve = res, reject = rej
      })

  arguments.length && resolve(arguments[0])
  p.resolve = resolve
  p.reject  = reject
  return p
}

function promiseArgs(i){
  return function(){
    return promise(arguments[i])
  }
}

function promiseSync(arg){
  return function() {
    var a = arguments
      , o = { then: function(cb){ cb(a[arg]); return o } }
    return o
  }
}

function promiseNoop(){
  return promise()
}

function promiseNull(){
  return promise(null)
}
},{}],35:[function(require,module,exports){
module.exports = function raw(selector, doc){
  var prefix = !doc && document.head.createShadowRoot ? 'html /deep/ ' : ''
  return (doc ? doc : document).querySelector(prefix+selector)
}
},{}],36:[function(require,module,exports){
var act = { add: add, update: update, remove: remove }
  , emitterify = require('./emitterify')
  , def = require('./def')
  , is  = require('./is')
  , str = JSON.stringify
  , parse = JSON.parse

module.exports = function set(d) {
  return function(o, existing, max) {
    if (!is.obj(o))
      return o

    if (!is.obj(d)) { 
      var log = existing || o.log || []
        , root = o

      if (!is.def(max)) max = log.max || 0
      if (!max)    log = []
      if (max < 0) log = log.concat(null)
      if (max > 0) {
        var s = str(o)
        root = parse(s) 
        log = log.concat({ type: 'update', value: parse(s), time: log.length })
      } 

      def(log, 'max', max)
      
      root.log 
        ? (root.log = log)
        : def(emitterify(root, null), 'log', log, 1)

      return root
    }

    if (is.def(d.key))
      apply(o, d.type, (d.key = '' + d.key).split('.'), d.value)

    if (o.log && o.log.max) 
      o.log.push((d.time = o.log.length, o.log.max > 0 ? d : null))

    if (o.emit)
      o.emit('change', d)

    return o
  }
}

function apply(body, type, path, value) {
  var next = path.shift()

  if (path.length) { 
    if (!(next in body)) 
      if (type == 'remove') return
      else body[next] = {}
    apply(body[next], type, path, value)
  }
  else 
    act[type](body, next, value)
}

function add(o, k, v) {
  is.arr(o) 
    ? o.splice(k, 0, v) 
    : (o[k] = v)
}

function update(o, k, v) { 
  o[k] = v 
}

function remove(o, k, v) { 
  is.arr(o) 
    ? o.splice(k, 1)
    : delete o[k]
}
},{"./def":15,"./emitterify":16,"./is":25}],37:[function(require,module,exports){
var is = require('./is') 

module.exports = function str(d){
  return d === 0 ? '0'
       : !d ? ''
       : is.fn(d) ? '' + d
       : is.obj(d) ? JSON.stringify(d)
       : String(d)
}
},{"./is":25}],38:[function(require,module,exports){
module.exports = { 
  arr: toArray
, obj: toObject
}

function toArray(d){
  return Array.prototype.slice.call(d, 0)
}

function toObject(d) {
  var by = 'id'
    , o = {}

  return arguments.length == 1 
    ? (by = d, reduce)
    : reduce.apply(this, arguments)

  function reduce(p,v,i){
    if (i === 0) p = {}
    p[v[by]] = v
    return p
  }
}
},{}],39:[function(require,module,exports){
var keys = require('./keys')
  , from = require('./from')

module.exports = function values(o) {
  return !o ? [] : keys(o).map(from(o))
}
},{"./from":20,"./keys":27}],40:[function(require,module,exports){
var key = require('./key')

module.exports = function za(k) {
  return function(a, b){
    var ka = key(k)(a) || ''
      , kb = key(k)(b) || ''

    return ka > kb ? -1 
         : ka < kb ?  1 
                   :  0
  }
}

},{"./key":26}]},{},[1]);
